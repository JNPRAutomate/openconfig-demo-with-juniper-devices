## Last changed: 2016-11-14 14:53:30 CET
version "16.1-20160926.0 [builder]";
system {
    host-name fabric-02;
    time-zone Europe/Amsterdam;
    root-authentication {
        encrypted-password "$1$wn55LLbk$SJsBNNKCq8U1z3OfQOwFh0";
    }
    name-server {
        172.30.207.10;
    }
    login {
        message "Welcome to EMEA SLAB ";
        user lab {
            uid 2000;
            class super-user;
            authentication {
                encrypted-password "$1$HT73bmKu$e.7tBoJ5HLlv9OtkaYwu40";
            }
        }
    }
    services {
        ssh;
        netconf {
            ssh;
        }
    }
    syslog {
        user * {
            any emergency;
        }
        file messages {
            any notice;
        }
        file cli-commands {
            interactive-commands any;
            explicit-priority;
        }
        time-format millisecond;
    }
    ntp {
        server 172.30.207.10;
    }
}
chassis {
    aggregated-devices {
        ethernet {
            device-count 2;
        }
    }
}
/* This block of configuration has been generated by the role underlay-ebgp for Ansible */
interfaces {
    xe-0/0/0 {
        unit 0 {
            family inet {
                address 192.168.1.2/24;
            }
        }
    }
    xe-0/0/1 {
        description " * to spine-02";
        mtu 9192;
        unit 0 {
            family inet {
                mtu 9000;
                address 172.16.0.15/31;
            }
        }
    }
    xe-0/0/2 {
        gigether-options {
            802.3ad ae0;
        }
    }
    xe-0/0/3 {
        gigether-options {
            802.3ad ae0;
        }
    }
    xe-1/2/0 {
        description " * to spine-01";
        mtu 9192;
        unit 0 {
            family inet {
                mtu 9000;
                address 172.16.0.11/31;
            }
        }
    }
    ae0 {
        flexible-vlan-tagging;
        encapsulation flexible-ethernet-services;
        esi {
            00:01:01:01:01:01:01:01:01:02;
            all-active;
        }
        aggregated-ether-options {
            lacp {
                active;
                periodic fast;
                system-id 00:00:00:01:01:02;
            }
        }
        unit 0 {
            family bridge {
                interface-mode trunk;
                vlan-id-list [ 100 101 102 103 ];
            }
        }
    }
    fxp0 {
        unit 0 {
            family inet {
                address 172.30.54.146/24;
            }
        }
    }
    irb {
        unit 100 {
            description " * TENANT 10 - vlan 100 - vni 9100 ";
            family inet {
                address 10.0.1.201/24 {
                    virtual-gateway-address 10.0.1.210;
                }
            }
        }
        unit 101 {
            description " * TENANT 10 - vlan 101 - vni 9101 ";
            family inet {
                address 10.0.2.201/24 {
                    virtual-gateway-address 10.0.2.210;
                }
            }
        }
        unit 102 {
            description " * TENANT 10 - vlan 102 - vni 9102 ";
            family inet {
                address 10.0.3.201/24 {
                    virtual-gateway-address 10.0.3.210;
                }
            }
        }
        unit 103 {
            description " * TENANT 10 - vlan 103 - vni 9103 ";
            family inet {
                address 10.0.4.201/24 {
                    virtual-gateway-address 10.0.4.210;
                }
            }
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 100.0.0.2/32;
            }
        }
    }
}
snmp {
    location "Site 1";
    contact "John Doe";
    community public {
        authorization read-only;
    }
}
routing-options {
    static {
        route 172.16.0.0/12 {
            next-hop 172.30.54.1;
            retain;
            no-readvertise;
        }
    }
    router-id 100.0.0.2;
    autonomous-system 200;
    forwarding-table {
        export pfe-ecmp;
        chained-composite-next-hop {
            ingress {
                evpn;
            }
        }
    }
}
protocols {
    mpls {
        interface xe-0/0/0.0;
    }
    bgp {
        log-updown;
        graceful-restart;
        group underlay-ipfabric {
            type external;
            mtu-discovery;
            import bgp-ipclos-in;
            export bgp-ipclos-out;
            local-as 65002;
            bfd-liveness-detection {
                minimum-interval 350;
                multiplier 3;
                session-mode automatic;
            }
            multipath multiple-as;
            neighbor 172.16.0.22 {
                peer-as 65014;
            }
            neighbor 172.16.0.14 {
                peer-as 65012;
            }
            neighbor 172.16.0.18 {
                peer-as 65013;
            }
            neighbor 172.16.0.10 {
                peer-as 65011;
            }
        }
        group evpn {
            type internal;
            local-address 100.0.0.2;
            family inet-vpn {
                unicast;
            }
            family evpn {
                signaling;
            }
            neighbor 100.0.0.1;
        }
        group test {
            type external;
            local-address 10.0.1.201;
            peer-as 100;
            neighbor 10.0.1.13;
            neighbor 10.0.1.14;
        }
    }
    ospf {
        area 0.0.0.0 {
            interface xe-0/0/0.0;
            interface lo0.0;
        }
    }
    ldp {
        interface xe-0/0/0.0;
    }
    lldp {
        interface all;
        interface xe-0/0/0;
    }
}
policy-options {
    policy-statement bgp-in {
        then accept;
    }
    policy-statement bgp-ipclos-in {
        term loopbacks {
            from {
                route-filter 100.0.0.0/16 orlonger;
            }
            then accept;
        }
    }
    policy-statement bgp-ipclos-out {
        term loopback {
            from {
                protocol direct;
                route-filter 100.0.0.2/32 orlonger;
            }
            then {
                next-hop self;
                accept;
            }
        }
    }
    policy-statement bgp-out {
        then accept;
    }
    policy-statement pfe-ecmp {
        then {
            load-balance per-packet;
        }
    }
}
routing-instances {
    VS_TENANT_10 {
        instance-type virtual-switch;
        interface ae0.0;
        route-distinguisher 100.0.0.2:10;
        vrf-target target:11:10;
        protocols {
            evpn {
                extended-vlan-list 100-103;
            }
        }
        bridge-domains {
            bd9100 {
                vlan-id 100;
                routing-interface irb.100;
            }
            bd9101 {
                vlan-id 101;
                routing-interface irb.101;
            }
            bd9102 {
                vlan-id 102;
                routing-interface irb.102;
            }
            bd9103 {
                vlan-id 103;
                routing-interface irb.103;
            }
            bd9104 {
                vlan-id 104;
                routing-interface irb.104;
            }
        }
    }
}
openconfig-bgp:bgp {
    neighbors {
        neighbor 192.168.1.1 {
            config {
                peer-as 104;
                peer-group OC;
            }
        }
    }
    peer-groups {
        peer-group OC {
            config {
                local-as 110;
                peer-type EXTERNAL;
            }
            apply-policy {
                config {
                    import-policy bgp-in;
                    export-policy bgp-out;
                }
            }
        }
    }
}